**总结**：在本教程中，您将学习如何使用 `PostgreSQL DROP TYPE` 语句从数据库中删除用户定义的类型。

# `PostgreSQL DROP TYPE` 语句简介

`DROP TYPE` 语句允许您从数据库中删除一个或多个用户定义的数据类型。

以下是 `DROP TYPE` 语句的语法：

```sql
DROP TYPE [IF EXISTS] type_name [CASCADE | RESTRICT];
```

在此语法中：

- 首先，在 `DROP TYPE` 关键字后指定要删除的用户定义类型的名称。
- 其次，仅使用 `IF EXISTS` 删除数据类型，前提是它存在。如果类型不存在，这可以防止错误，从而使您的命令更加健壮。
- 第三，使用 `CASCADE` 删除依赖于类型的对象，例如表列和函数，进而删除依赖于这些对象的所有对象。默认情况下，`DROP TYPE` 语句使用 `RESTRICT` 选项，如果有任何对象依赖于该类型，则该选项拒绝删除该类型。

如果要同时删除多个类型，可以在 `DROP TYPE` 语句中列出它们：

```sql
DROP TYPE type_name1, type_name2, ...;
```

# 基本 `DROP TYPE` 语句示例

首先，创建一个名为 `contact` 的新类型：

```sql
CREATE TYPE contact AS ( 
    phone TEXT, 
    email TEXT 
);
```

其次，使用 `DROP TYPE` 语句删除 `contact` 类型：

```sql
DROP TYPE IF EXISTS contact;
```

# 删除具有依赖对象的用户定义类型

首先，创建一个名为 `address` 的新复合类型，其中包括 `city`、`street`、`zip_code`、`state` 和 `country`：

```sql
CREATE TYPE address AS (
  city VARCHAR,
  street VARCHAR,
  zip_code VARCHAR,
  state VARCHAR,
  country VARCHAR
);
```

其次，创建一个名为 `customers` 的表来存储客户信息。`customers` 表使用 `address` 类型：

```sql
CREATE TABLE customers (
  id INT GENERATED BY DEFAULT AS IDENTITY,
  name VARCHAR NOT NULL,
  email VARCHAR NOT NULL,
  billing_address address,
  shipping_address address
);
```

第三，尝试删除 `address` 类型：

```sql
DROP TYPE address;
```

`PostgreSQL` 发出以下错误：

```sql
ERROR:  cannot drop type address because other objects depend on it
DETAIL:  column shipping_address of table customers depends on type address
column billing_address of table customers depends on type address
HINT:  Use DROP ... CASCADE to drop the dependent objects too.
```

错误显示 `customers` 表的 `shipping_address` 和 `billing_address` 列使用 `address` 类型;因此，不能使用 `RESTRICT`（默认值）删除它。您必须使用 `DROP TYPE ... CASCADE `也删除依赖对象。

如果这些列有数据并且您想保留它，则需要备份表，更改这些列的类型（例如，更改为 `TEXT` ），然后在不使用 `CASCADE` 选项的情况下删除类型。

最后，删除带有 `CASCADE` 选项的类型 `address` ：

```sql
DROP TYPE address CASCADE;
```

输出：

```sql
NOTICE:  drop cascades to 2 other objects
DETAIL:  drop cascades to column shipping_address of table customers
drop cascades to column billing_address of table customers
```

输出显示，该语句删除了 `customers` 表中的 `shipping_address` 列和 `billing_address` 列。

# 总结

- 使用 `DROP TYPE` 语句从数据库中删除用户定义的类型。
- 使用 `IF EXISTS` 选项可避免在类型不存在时出现错误。
- 在使用 `CASCADE` 选项之前，请仔细检查依赖对象，因为它也会删除这些对象。

