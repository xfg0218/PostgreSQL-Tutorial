**摘要**: 在本教程中，你将了解 `NULL` 以及如何使用 `PostgreSQL` 的 `NOT NULL` 约束来确保列不会包含 `NULL` 。

# `NULL` 简介 

`NULL` 表示值的缺失，表明数据未知或不存在。

例如，如果你想记录仓库信息，但在记录时不知道其地址，可以在 `address` 列中填入`NULL` 。之后，你可以用正确的地址更新 `address` 列中的 `NULL` 。

请注意，`NULL` 表示未知值。它与空字符串 `('')` 或零 `(0)` 不同，后两者是已定义的值。

`PostgreSQL` 对 `NULL` 使用三值逻辑。这意味着如果你将 `NULL` 与任何值进行比较，比较结果将返回 `NULL`。

例如，将 `NULL` 与数字进行比较，结果将为 `NULL`:

```sql
SELECT
  NULL = 1 AS result;
```

输出:

```sql
 result
--------
 NULL
```

即使 `NULL` 不等于 `NULL`;将 `NULL` 与 `NULL` 进行比较的结果也为 `NULL` :

```sql
SELECT
  NULL = NULL AS result;
```

这个结果是合理的，因为将一个未知值与另一个值进行比较，会得出一个未知的结果。

# 向列中插入 `NULL`

当你为表定义列时，该列是可空的。这意味着你可以向该列插入 `NULL` 。

例如，下面的语句会创建一个名为 `warehouses` 的表:

```sql
CREATE TABLE warehouses (
  warehouse_id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  name VARCHAR(255),
  address VARCHAR(255)
);
```

`name` 和 `address` 列的数据类型为 `VARCHAR` ，但它们可以接受 `NULL` 值。

以下 `INSERT` 语句向 `warehouses` 表中插入一个新行，其中 `address` 列的值为 `NULL` :

```sql
INSERT INTO
  warehouses (name, address)
VALUES
  ('San Jose', NULL)
RETURNING
  name,
  address;
```

输出:

```sql
   name   | address
----------+---------
 San Jose | NULL
```

如果在 `INSERT` 语句中省略某一列，`PostgreSQL` 会使用 `NULL` 作为默认值。例如：

```sql
INSERT INTO
  warehouses (name)
VALUES
  ('San Francisco')
RETURNING
  name,
  address;
```

输出:

```sql
     name      | address
---------------+---------
 San Francisco | NULL
```

# 使用 `PostgreSQL` 的 `NOT NULL` 约束

要确保列不能包含 `NULL` 值，请使用 `NOT NULL` 约束。

以下是为列定义 `NOT NULL` 约束的语法：

```sql
column_name data_type NOT NULL
```

定义 `NOT NULL` 约束后，该列将不接受 `NULL` 值。如果尝试插入 `NULL` 值， `PostgreSQL` 会抛出错误。

> 请注意，[主键](主键.md) 列隐式具有 `NOT NULL` 约束。

`NOT NULL` 约束对于维护数据库中的数据完整性和一致性至关重要。

通过实施 `NOT NULL` 约束，你可以确保像电子邮件地址这样的重要列始终有值。`NOT NULL` 约束可防止因 `NULL` 值而导致数据处理出错的情况。

`NOT NULL` 约束简化了数据管理，因为您无需编写额外的逻辑来处理 `NULL` ，这使得您的 `SQL` 语句更简单、更高效。

`NOT NULL` 约束还有助于在数据库层面执行业务规则，确保应用程序不会使用未知值运行。

# `PostgreSQL` 非空约束示例

首先，删除 `warehouses` 表:

```sql
DROP TABLE IF EXISTS warehouses;
```

其次，重新创建 `warehouses` 表，其 `name` 和 `address` 列具有 `NOT NULL` 约束

```sql
CREATE TABLE warehouses (
  warehouse_id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  address VARCHAR(255) NOT NULL
);
```

第三，尝试将 `NULL` 插入到 `address` 列中:

```sql
INSERT INTO
  warehouses (name, address)
VALUES
  ('San Meto', NULL)
RETURNING
  name,
  address;
```

错误:

```sql
ERROR: null value in column "address" of relation "warehouses" violates not-null constraint
```

`PostgreSQL` 发生了非空约束冲突，并拒绝了插入操作。

最后，向 `warehouses` 表中插入一个新行：

```sql
INSERT INTO
  warehouses (name, address)
VALUES
  (
    'San Meto',
    ' 1st Ave Suite K03, San Mateo, CA 94403'
  )
RETURNING
  name,
  address;
```

输出:

```sql
   name   |                 address
----------+-----------------------------------------
 San Meto |  1st Ave Suite K03, San Mateo, CA 94403
```

# 总结

- `NULL` 表示没有值。
- 涉及 `NULL` 的比较将产生 `NULL` 。
- 表列默认接受 `NULL` 。
- 使用 `NOT NULL` 约束可确保列不接受 `NULL` 。
